//      Canvas based photoviewer
//      coded by Andreas Briese
//      (c)2011 eduToolbox@Bri-C GmbH
//      http://eduToolbox.de
// 
//      Vorbereitung:
//      10 jpeg-Bilder mit den Namen 00.jpg .. 09.jpg
//      in einen Unter-Ordner "fotos" legen, der innerhalb des 
//      Ordners liegt, in dem diese html-Datei liegt.
//      use: 
//      put 10 jpeg-Images named 00.jpg .. 09.jpg
//      into a sub-folder called fotos within the folder
//      where this html-file is located.

var photoviewerCanvas=this.document;var photoviewer={};photoviewer.bigBildIdx=0;photoviewer.photolist={};photoviewer.smallThumbBreite=60;photoviewer.smallThumbHoehe=45;photoviewer.bigBildBreite=600;photoviewer.obenUntenDistMinimum=35;photoviewer.bigBildHoehe=450;photoviewer.bildZaehler=0;photoviewer.autoplayerTimelapse=2500;Array.prototype.sum=function(){var c=0;try{for(var a=0;a<this.length;a++){c+=this[a]}}catch(b){}return c};Number.prototype.digit=function(){return(this>=0&&this<10)?("0"+this):this};function Rad(a){return(a*Math.PI/180)}function drehe(d,b,a,c){d.save();d.setTransform(1,0,0,1,0,0);d.translate(b,a);d.rotate(Rad(c));d.translate(-b,-a)}function initr(){for(var i=0;i<10;i++){eval("photoviewer.photolist.photo"+i.digit()+" = new Image();");eval("photoviewer.photolist.photo"+i.digit()+'.addEventListener("load",photoLoaded,false);');eval("photoviewer.photolist.photo"+i.digit()+'.src = "fotos/'+i.digit()+'.jpg";')}this.focus();photoviewerCanvas.addEventListener("keydown",keypressd,false);photoviewer.autoplayer=setInterval(autoplayNext,photoviewer.autoplayerTimelapse)}function photoLoaded(a){photoviewer.bildZaehler++;if(photoviewer.bildZaehler==10){renderSmall()}renderBig(photoviewer.photolist.photo00)}function checkCol(e){var d=0;var b=2;var c=[];for(var a=1;a<e.data.length;a+=4){if((e.data[a]+e.data[a+1]+e.data[a+2])>d){d=e.data[a]+e.data[a+1]+e.data[a+2];c=[];c.push(Math.floor(e.data[a]/b));c.push(Math.floor(e.data[a+1]/b));c.push(Math.floor(e.data[a+2]/b))}}return c}function renderSmall(){var smallBackground="rgba(255,255,255,0.7)";var small=photoviewerCanvas.getElementById("small");smallCtx=small.getContext("2d");smallCtx.fillStyle=smallBackground;smallCtx.fillRect(0,0,10*photoviewer.smallThumbBreite,photoviewer.smallThumbHoehe);smallCtx.strokeStyle=smallBackground;smallCtx.lineWidth=1;for(var i=0;i<photoviewer.bildZaehler;i++){eval("var bild = photoviewer.photolist.photo"+i.digit());var diesesBildHoehe=Math.floor(bild.height*photoviewer.smallThumbBreite/bild.width);if(diesesBildHoehe>(photoviewer.smallThumbHoehe-6)){diesesBildHoehe=photoviewer.smallThumbHoehe-6}var OberLinienHoehe=Math.floor(0.5*(photoviewer.smallThumbHoehe-diesesBildHoehe));if(OberLinienHoehe<2){OberLinienHoehe=2}smallCtx.drawImage(bild,0,0,bild.width,bild.height,i*photoviewer.smallThumbBreite,OberLinienHoehe,photoviewer.smallThumbBreite,diesesBildHoehe);smallCtx.strokeRect((0.5+i*photoviewer.smallThumbBreite),OberLinienHoehe,photoviewer.smallThumbBreite-1,diesesBildHoehe)}small.style.top=(photoviewer.bigBildHoehe+1)+"px";small.style.left="0px";small.style.display="block";photoviewerCanvas.addEventListener("mousemove",mouseOverSmall,false)}function mouseOverSmall(evt){var big=photoviewerCanvas.getElementById("big");var small=photoviewerCanvas.getElementById("small");var mouseX=evt.clientX-small.offsetLeft;var mouseY=evt.clientY;if(mouseY>(photoviewer.bigBildHoehe+big.offsetTop)&&mouseY<=(small.offsetTop+photoviewer.smallThumbHoehe)){photoviewerCanvas.getElementById("small").style.opacity="0.5";if(photoviewer.autoplayer){clearInterval(photoviewer.autoplayer)}if(Math.floor(mouseX/photoviewer.smallThumbBreite)!=photoviewer.bigBildIdx){photoviewer.bigBildIdx=Math.floor(mouseX/photoviewer.smallThumbBreite);eval("var bild = photoviewer.photolist.photo"+photoviewer.bigBildIdx.digit());if(bild){renderBig(bild)}}}if(small.style.opacity!="1"){small.style.opacity="1"}}function renderBig(f){try{var g=photoviewer.obenUntenDistMinimum;var o="Screenshots";var n="";var p="";var i=["rgba(80,95,95,","rgba(30,50,30,","rgba(70,20,20,","rgba(200,200,200,","rgba(130,130,130,","rgba(90,30,30,","rgba(30,50,30,","rgba(200,200,200,","rgba(30,30,30,","rgba(90,30,30,"];var c=photoviewerCanvas.getElementById("big");bigCtx=c.getContext("2d");var r=Math.floor(f.height*photoviewer.bigBildBreite/f.width);if(r>photoviewer.bigBildHoehe){r=photoviewer.bigBildHoehe}var b=Math.floor(0.5*(photoviewer.bigBildHoehe-r));bigCtx.fillStyle="rgba(200,200,200,1)";bigCtx.fillRect(0,0,photoviewer.bigBildBreite,photoviewer.bigBildHoehe);bigCtx.drawImage(f,0,0,f.width,f.height,0,b,photoviewer.bigBildBreite,r);var q=bigCtx.createImageData(10,r);q=bigCtx.getImageData(0,b,10,r);var m=checkCol(q);q=bigCtx.getImageData(photoviewer.bigBildBreite-10,b,10,r);var d=checkCol(q);var h=(m.sum()>d.sum())?m:d;bigCtx.strokeStyle="rgba("+h[1]+","+h[2]+","+h[0]+",0.4)";bigCtx.lineWidth=b;bigCtx.strokeRect(0.5,b,photoviewer.bigBildBreite-1,r-1);bigCtx.fillStyle="rgba(10,10,10,1)";bigCtx.fillRect(0,0,photoviewer.bigBildBreite,b);bigCtx.fillStyle="rgba("+h[1]+","+h[2]+","+h[0]+",0.7)";bigCtx.fillRect(0,0,photoviewer.bigBildBreite,b);bigCtx.fillStyle="rgba(255,255,255,1)";bigCtx.font="normal bold 20px sans-serif";bigCtx.textBaseline="bottom";bigCtx.textAlign="start";bigCtx.fillText(o,7,25);bigCtx.font="normal bold 20px sans-serif";bigCtx.textBaseline="bottom";bigCtx.textAlign="end";bigCtx.fillText(n,(photoviewer.bigBildBreite-7),25);bigCtx.setTransform(1,0,0,1,0,0);var a="(C) 2011 eduToolbox@Bri-C";var k=photoviewer.bigBildBreite-3;var j=photoviewer.bigBildHoehe-b-bigCtx.measureText(a).width;drehe(bigCtx,k,j,270);bigCtx.fillStyle="#aaa";bigCtx.font="normal bold 10px sans-serif";bigCtx.fillText(a,k,j);bigCtx.setTransform(1,0,0,1,0,0);c.style.top="0px";c.style.left="0px";c.style.display="block"}catch(l){}}function keypressd(evt){switch(evt.keyCode){case 37:if(photoviewer.autoplayer){clearInterval(photoviewer.autoplayer)}photoviewer.bigBildIdx=(photoviewer.bigBildIdx>0)?(photoviewer.bigBildIdx-1):photoviewer.bildZaehler-1;renderBig(eval("photoviewer.photolist.photo"+photoviewer.bigBildIdx.digit()));break;case 39:if(photoviewer.autoplayer){clearInterval(photoviewer.autoplayer)}photoviewer.bigBildIdx=(photoviewer.bigBildIdx<photoviewer.bildZaehler-1)?(photoviewer.bigBildIdx+1):0;renderBig(eval("photoviewer.photolist.photo"+photoviewer.bigBildIdx.digit()));break}photoviewerCanvas.getElementById("small").style.opacity="0.5"}function canvasCheckr(){if(!photoviewerCanvas.createElement("canvas").getContext){var a=photoviewerCanvas.createElement("div");a.id="copyrights";a.firstChild.innerHTML="(C) 2014 eduToolbox@Bri-C";photoviewerCanvas.body.appendChild(a);if(window.navigator.appName.find("MSIE")!=-1){makeIEWindow()}}else{initr()}}function autoplayNext(){photoviewer.bigBildIdx=(photoviewer.bigBildIdx<photoviewer.bildZaehler-1)?(photoviewer.bigBildIdx+1):0;renderBig(eval("photoviewer.photolist.photo"+photoviewer.bigBildIdx.digit()));photoviewerCanvas.getElementById("small").style.opacity="0.5"}function makeIEWindow(){while(documnet.body.childNodes.length>1){document.body.removeNode(document.body.firstChild)}var a=photoviewerCanvas.createElement("div");a.id="bildFeld";a.style.width="800px";a.style.height="600px";photoviewerCanvas.body.appendChild(cp)}
photoviewerCanvas.onload = canvasCheckr();
